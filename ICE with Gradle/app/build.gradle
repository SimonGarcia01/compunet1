/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details on building Java & JVM projects, please refer to https://docs.gradle.org/8.8/userguide/building_java_projects.html in the Gradle documentation.
 */

plugins {
    // Apply the application plugin to add support for building a CLI application in Java.
    id 'com.zeroc.gradle.ice-builder.slice' version '1.5.0' apply false
}

subprojects {
    apply plugin: 'java'
    apply plugin: 'com.zeroc.gradle.ice-builder.slice'
    slice{
        java{
            files = [file('../App.ice')]
        }
    }


    repositories {
        // Use Maven Central for resolving dependencies --> refers to the page with dependencies
        mavenCentral()
    }

    dependencies {
        // https://mvnrepository.com/artifact/com.zeroc/ice
        implementation 'com.zeroc:ice:3.7.4'

        // Use JUnit Jupiter for testing.
        testImplementation libs.junit.jupiter

        testRuntimeOnly 'org.junit.platform:junit-platform-launcher'

        // This dependency is used by the application.
        implementation libs.guava
    }

    task copyIceJar(type: Copy){
        from configurations.runtimeClassPath
        include 'ice-3.7.4.jar'
        into '$buildDir/libs'
    }

    jar.dependsOn copyIceJar

    jar{
        manifest{
            attributes(
                "Main-Class": project.name.capitalize(),
                "Class-Path": configurations.runtimeClasspath.files.collect {"${it.name}"}.join(' ') 
            )
        }
    }

    // Apply a specific Java toolchain to ease working on different environments.
    java {
        toolchain {
            languageVersion = JavaLanguageVersion.of(21)
        }
    }

    application {
        // Define the main class for the application.
        mainClass = 'ice.with.gradle.App'
    }

    tasks.named('test') {
        // Use JUnit Platform for unit tests.
        useJUnitPlatform()
    }
}
